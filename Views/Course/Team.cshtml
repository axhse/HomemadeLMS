@using HomemadeLMS.Models.Domain
@model TeamVM
@{
	ViewData["Title"] = "Команда";
	ViewData["NavbarMenu"] = MenuBuilder.DefaultNavbarMenu;

	var team = Model.Team;
	var leaderUsername = team.LeaderUsername;
	var members = Model.AllMemberInfo;
	members.Sort(Comparators.ByNameThenByUsername);
	members = members.Where(member => member.Member.Username == leaderUsername)
					 .Concat(members.Where(member => member.Member.Username != leaderUsername))
					 .ToList();
	var canChangeTeam =  Model.Member.CanChangeTeam(Model.Course);
	var canEditTeam =  Model.Member.CanEditTeam(Model.Course, Model.Team);
}

<div class="col-12 col-lg-8">
	<h6 class="fw-bold">@team.Name</h6>
	<div class="mt-3"></div>
	<label class="text-success fw-bold">@team.Tag</label>
	<div class="mt-5"></div>
	@foreach (var member in members)
	{
		var name = member.Account?.Name;
		var url = $"/course/member?courseId={team.CourseId}&username={member.Member.Username}";

		<div class="mt-1"></div>
		<a href=@url>@(name is null ? member.Member.Username : name)</a>
		@if (member.Member.Username == leaderUsername)
		{
			<label class="ms-4 fw-bold">лидер</label>
			<div class="mt-4"></div>
		}
	}
	<div class="mt-5"></div>
	@if (canChangeTeam || canEditTeam)
	{
		<div class="mt-5"></div>
		<form method="POST">
			@if (canChangeTeam)
			{
				@if (Model.Member.TeamId == team.Id)
				{
					<button type="submit" class="btn btn-secondary" name="actionCode" value="leave">
						Уйти из команды
					</button>
				}
				else
				{
					<button type="submit" class="btn btn-secondary" name="actionCode" value="join">
						Присоединиться
					</button>
				}
			}
			@if (canEditTeam)
			{
				<a class="btn btn-secondary" href="/course/team/edit?id=@team.Id">Редактировать</a>
				<button type="submit" class="btn btn-danger" name="actionCode" value="delete">
					Удалить
				</button>
			}
		</form>
	}
	<div class="mt-5"></div>
	<a href="/course/teams?courseId=@Model.Course.Id">Все команды</a>
</div>
